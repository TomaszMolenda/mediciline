<!DOCTYPE html>
<html>
<head>
</head>
<body>
<div th:fragment="modal" class="modal fade" id="modalAddDosage">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 th:text="#{AddDosage}" class="modal-title"></h4>
			</div>
			<div class="modal-body">
				<fieldset class="form-group">
					<div>
						<div style="float: left;">
							<div>
								<button id="btnHourUp" type="button" class="btn btn-primary btn-time"><span class="glyphicon glyphicon-chevron-up"></span></button>
							</div>
							<div id="hourValue" style="text-align: center;">
							12
							</div>
							<div>
								<button id="btnHourDown" type="button" class="btn btn-primary btn-time"><span class="glyphicon glyphicon-chevron-down"></span></button>
							</div>
						</div>
						<div style="float: left; margin-left: 10px;" >
							<div>
								<button id="btnMinuteUp" type="button" class="btn btn-primary btn-time"><span class="glyphicon glyphicon-chevron-up"></span></button>
							</div>
							<div id="minuteValue" style="text-align: center;">
							00
							</div>
							<div>
								<button id="btnMinuteDown" type="button" class="btn btn-primary btn-time"><span class="glyphicon glyphicon-chevron-down"></span></button>
							</div>
						</div>
						<div style="clear: both;"></div>
						<script type="text/javascript">
							var timeToSend = "12:00";
							$('#btnHourUp').click(function(){
								var hour = $('#hourValue').html();
								hour++;
								if(hour==24) hour = 0;
								$('#hourValue').html(hour);
							});
							$('#btnHourDown').click(function(){
								var hour = $('#hourValue').html();
								hour--;
								if(hour==-1) hour = 23;
								$('#hourValue').html(hour);
							});
							$('#btnMinuteUp').click(function(){
								var minute = $('#minuteValue').html();
								minute = minute * 1 + 5;
								if(minute==60) minute = 0;
								if(minute<10) $('#minuteValue').html("0" + minute);
								else $('#minuteValue').html(minute);
							});
							$('#btnMinuteDown').click(function(){
								var minute = $('#minuteValue').html();
								minute = minute - 5;
								if(minute<0) minute = 55;
								if(minute<10) $('#minuteValue').html("0" + minute);
								else $('#minuteValue').html(minute);
							});
							$('.btn-time').click(function(){
								var hour = $('#hourValue').html().trim();
								var minute = $('#minuteValue').html().trim();
								if(hour<10)
									timeToSend = "0" + hour + ":" + minute;
								else
									timeToSend = hour + ":" + minute;
							});
						</script>
					</div>
				</fieldset>
				<fieldset class="form-group">
					<label th:text="#{AddDosage}" for="addDosageDosage"></label>
					<input type="number" class="form-control" id="addDosageDosage" th:placeholder="#{WriteNumber}" value="1" autocomplete="off">
				</fieldset>
			</div>		
			<div class="modal-footer">
				<span id="loadingAdd" hidden>
					<span th:text="#{working}"></span>
					<img th:src="@{/resources/jpg/loading.gif}">
				</span>
               	<button id="modalAddDosageCancel" th:text="#{Cancel}" type="button" class="btn btn-default" data-dismiss="modal"></button>
               	<script type="text/javascript">
               	$('#modalAddDosageCancel').on('click', function(){
					showModal($('#modalDosages'));
				});
               	</script>
    			<button id="saveDosage" th:text="#{Save}" type="button" class="btn btn-default"></button>
    			<script type="text/javascript">
    			$('#saveDosage').on('click', function(){
    				$('#loadingAdd').prop('hidden', false);
    				$('#saveDosage').attr("disabled", true);
    				var dose = $('#addDosageDosage').val();
               		var json = { "idD" : idD,
               				"idM" : idM,
							"takeTime" : timeToSend, 
							"dose" : dose};
               		$.ajax({
						url: '/api/dosage/add',
						data: JSON.stringify(json),
						type: 'POST',
						beforeSend: function(xhr) {
							
							xhr.setRequestHeader("Accept", "application/json");
							xhr.setRequestHeader("Content-Type", "application/json");
						},
						complete: function(data){
							$('#loadingAdd').prop('hidden', true);
							$('#saveDosage').attr("disabled", false);
							hideModal($('#modalAddDosage'));
							getDosages();
						}
					});
				});
    			</script>
            </div>
        </div>
    </div>
</div>
</body>
</html>